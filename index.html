<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>StageSync – Year 9 Drama</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="home-page page-loading">
  <!-- Entry gate: PIN required to access site -->
  <div id="entry-gate" class="entry-gate">
    <div id="entry-curtain" class="entry-curtain" aria-hidden="true">
      <div class="entry-curtain-panel entry-curtain-left"></div>
      <div class="entry-curtain-panel entry-curtain-right"></div>
    </div>
    <div class="entry-gate-card card">
      <h1 class="entry-gate-title">StageSync</h1>
      <p class="entry-gate-subtitle">Year 9 Drama</p>
      <p style="margin: 0 0 1rem; color: var(--text);">Enter your private PIN to continue.</p>
      <div id="entry-pin-form" style="display: flex; flex-direction: column; gap: 1rem;">
        <input type="password" id="entry-pin-input" class="pin-input" placeholder="Enter PIN" autocomplete="off" maxlength="20" style="width: 100%; padding: 0.75rem; font-size: 1.1rem; text-align: center; letter-spacing: 0.2em; border: 2px solid var(--cream-darker); border-radius: 8px; font-family: monospace;" />
        <button type="button" id="entry-pin-submit" class="pin-submit-btn">Enter</button>
        <p id="entry-pin-error" class="auth-error" style="display: none; margin: 0; text-align: center;"></p>
      </div>
    </div>
  </div>

  <!-- Main site (hidden until PIN verified) -->
  <div id="site-content" hidden>
  <header class="site-header">
    <div class="nav-inner">
      <a class="nav-home" href="index.html">StageSync</a>
      <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <nav class="nav-menu" id="nav-menu">
        <a href="cast.html">Characters and Roles</a>
        <a href="calendar.html">Calendar</a>
        <a href="chat.html">Chat</a>
        <a href="set-the-stage.html">Set The Stage</a>
        <a href="script.html">Script</a>
        <button type="button" id="nav-sign-out" class="nav-sign-out link-style-btn" style="background: none; border: none; font: inherit; color: inherit; cursor: pointer; padding: 0; margin-left: 0.5rem;">Sign out</button>
      </nav>
    </div>
  </header>

  <main class="page">
    <section class="home-hero">
      <h1>Welcome to StageSync</h1>
      <p class="home-subtitle">Your central hub for the Year 9 Drama production</p>
    </section>

    <div class="home-intro card">
      <h2>What is StageSync?</h2>
      <p>StageSync is a collaborative platform designed for the cast and crew of the Year 9 Drama production. It helps everyone stay organized, communicate, and keep track of rehearsals, characters, production roles, and important information.</p>
    </div>

    <div class="home-section card">
      <h2>How to use StageSync</h2>
      <div class="home-steps">
        <div class="home-step">
          <span class="step-number">1</span>
          <div>
            <h3>Characters and Roles</h3>
            <p>Click on your name in the <a href="cast.html">Characters and Roles</a> page to access your personal page. Here you can view your characters, add notes about props and costumes, and see your production roles.</p>
          </div>
        </div>
        <div class="home-step">
          <span class="step-number">2</span>
          <div>
            <h3>Calendar</h3>
            <p>Check the <a href="calendar.html">calendar</a> to see rehearsal schedules, important dates, events and due dates.</p>
          </div>
        </div>
        <div class="home-step">
          <span class="step-number">3</span>
          <div>
            <h3>Chat</h3>
            <p>Use <a href="chat.html">chat</a> for group discussions to communicate with directors and ask any questions.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="home-section card home-rules">
      <h2>Rules & Guidelines</h2>
      <ul class="home-list">
        <li><strong>Be respectful</strong> – This is a collaborative space. Treat everyone with kindness and professionalism.</li>
        <li><strong>Keep it relevant</strong> – Use <a href="chat.html">chat</a> for production-related discussions only.</li>
        <li><strong>Edit responsibly</strong> – Only directors can edit the <a href="calendar.html">calendar</a>. Cast members are allowed to edit their character ideas for anything they think the director should know or that should be added to their character's individual personality, but however they are not allowed to edit any of the props, costumes, or anything else in the site as that is only delegated specifically for production roles. For example, Duncan, Ben and Albie will be editing all of the props and costumes section for each of the characters, which will be overlooked by the directors.</li>
        <li><strong>Check regularly</strong> – Keep an eye on the <a href="calendar.html">calendar</a> for updates and rehearsal changes.</li>
        <li><strong>Ask questions</strong> – If you're unsure about anything, use <a href="chat.html">chat</a> to reach out to the directors.</li>
      </ul>
    </div>

    <div class="home-cta">
      <a href="cast.html" class="home-cta-button">View Characters and Roles →</a>
      <a href="calendar.html" class="home-cta-button home-cta-secondary">Open Calendar →</a>
    </div>
  </main>
  </div>
  <script>
    (function() {
      // Curtain: open on first click or scroll (wheel)
      (function initCurtain() {
        var curtain = document.getElementById('entry-curtain');
        if (!curtain) return;
        function openCurtain() {
          if (curtain.classList.contains('curtain-open')) return;
          curtain.classList.add('curtain-open');
        }
        function onCurtainFinished(e) {
          if (e.target.classList.contains('entry-curtain-panel')) {
            curtain.classList.add('curtain-finished');
            curtain.removeEventListener('animationend', onCurtainFinished);
          }
        }
        curtain.addEventListener('click', openCurtain, { once: true });
        curtain.addEventListener('wheel', openCurtain, { once: true, passive: true });
        curtain.addEventListener('touchstart', openCurtain, { once: true, passive: true });
        curtain.addEventListener('animationend', onCurtainFinished);
      })();

      // Run entry gate first, before any other scripts
      var ENTRY_PIN_MAP = {
        '1827': 'lucas', '2938': 'cc', '4069': 'angus', '5170': 'duncan',
        '6281': 'albie', '7392': 'alex', '8403': 'ben', '9514': 'cristian',
        '0625': 'eli', '1736': 'jeremy', '2849': 'kane', '3950': 'lenny', '4061': 'jordan'
      };
      var AUTH_KEY = 'stagesync_chat_auth';

      function getStoredAuth() {
        try {
          var raw = localStorage.getItem(AUTH_KEY);
          return raw ? JSON.parse(raw) : null;
        } catch (e) { return null; }
      }
      function setStoredAuth(pin, castMember) {
        try {
          localStorage.setItem(AUTH_KEY, JSON.stringify({ pin: pin, castMember: castMember, timestamp: Date.now() }));
        } catch (e) {}
      }
      function clearStoredAuth() {
        try { localStorage.removeItem(AUTH_KEY); } catch (e) {}
      }

      function init() {
        var gate = document.getElementById('entry-gate');
        var content = document.getElementById('site-content');
        var input = document.getElementById('entry-pin-input');
        var errEl = document.getElementById('entry-pin-error');
        var submitBtn = document.getElementById('entry-pin-submit');

        if (!gate || !content || !input || !submitBtn) return;

        function showError(msg) {
          if (errEl) { errEl.textContent = msg; errEl.style.display = 'block'; }
          if (input) input.style.borderColor = '#d32f2f';
        }
        function hideError() {
          if (errEl) errEl.style.display = 'none';
          if (input) input.style.borderColor = '';
        }

        function applyAuth(animate) {
          var auth = getStoredAuth();
          var valid = auth && auth.pin && ENTRY_PIN_MAP[auth.pin];
          if (valid) {
            if (animate) {
              gate.classList.add('dissolving');
              gate.addEventListener('animationend', function onDone() {
                gate.removeEventListener('animationend', onDone);
                gate.style.display = 'none';
                gate.classList.remove('dissolving');
                content.style.display = 'block';
                content.removeAttribute('hidden');
                content.classList.add('revealing');
                setTimeout(function() { content.classList.remove('revealing'); }, 500);
              }, { once: true });
            } else {
              gate.style.display = 'none';
              content.style.display = 'block';
              content.removeAttribute('hidden');
            }
          } else {
            gate.style.display = '';
            content.style.display = 'none';
            content.setAttribute('hidden', '');
          }
        }

        function doSubmit() {
          var pin = input.value.trim();
          if (!pin) { hideError(); showError('Please enter your PIN.'); return; }
          if (!ENTRY_PIN_MAP[pin]) {
            hideError();
            showError('Invalid PIN. Please try again.');
            input.value = '';
            input.focus();
            return;
          }
          hideError();
          setStoredAuth(pin, ENTRY_PIN_MAP[pin]);
          applyAuth(true);
        }

        submitBtn.onclick = function() { doSubmit(); };
        input.onkeydown = function(e) { if (e.key === 'Enter') { e.preventDefault(); doSubmit(); } };
        input.oninput = hideError;

        applyAuth(false);

        var signOut = document.getElementById('nav-sign-out');
        if (signOut) signOut.onclick = function() { clearStoredAuth(); applyAuth(); input.value = ''; input.focus(); };
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
  <script src="js/page-transitions.js"></script>
  <script src="js/nav.js"></script>
  <script src="js/pin-config.js"></script>
  <script src="js/entry-auth.js"></script>
</body>
</html>
